{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/2020/promise.allSettled","result":{"data":{"markdownRemark":{"html":"<p><br /><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/87e21874a5e8a5fdaebf2ea0ccceca90/cea38/promise.allsettled.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 65.14285714285714%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACKElEQVQ4y42T227TQBCG+yYgmvgQn892fKoVBATnFiRaCHkEJISQuEClCJqA1CKi5B244YIXKuWCFjXlBSLtz+y6FEEb4OLXvzP2fDtr76zdfvdl2d8/XNbT4+Vg/n1Zz07J/1PiXaqZfhMMzlrr739GPT3CxpNPCLdeIhm9RfRwTJogPhOPf/n4PB+P3lDNDsrHH1G//wrOWuvvHTDajUWbO0zTVOZlGTM8jykkPQ6ZFTtM8y1mJS7TA5uZkcNMyvHYyQKmGi3m3XnKBrMTxlkciMF8gXg4Qcf24RQ3YMQbUKMSWreCkebQkhxWVkAnN9KiEcVWWUH1PASbL1DPTtDfazrEYLag4+xC8T2oXYJRoZaWMLOKnIqiHGpcoJOU6ER8gwI25Y2kgmLZCO49/wM4P0X44LUAWtVNGEVFfh1B7xZ13KPCEkqYQglSqAH3rnA1zNE2zBXA+68gmSb0rEfdNF10uqUolL2ENkshcadYcmO07BBtt4t1Tb8IrOnIyWgC1bbRdhJShLbNFTbrS8ShkrcCyDuMhrto6Tpkv+mg7UZC0gqY8L8Bw+EYku3Sn+0RNIMcZHS87HzdxLmIOYhL9nO0DIv+8vZFIE+uy9eguIH40LLtkFz6rhYkyyHZ9MwTzrvi4rCrrSuge0g3hQMPcDYpx+K2+3efiWnh9+pSbf1cbzeiKfGopnj0gSblqJkUmj9aHIoEv4+89X9p8JsWYnQ5g7N+AOnOF62X/095AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Promise.allSettled\" title=\"Promise.allSettled\" src=\"/static/87e21874a5e8a5fdaebf2ea0ccceca90/8c557/promise.allsettled.png\" srcset=\"/static/87e21874a5e8a5fdaebf2ea0ccceca90/4edbd/promise.allsettled.png 175w,\n/static/87e21874a5e8a5fdaebf2ea0ccceca90/13ae7/promise.allsettled.png 350w,\n/static/87e21874a5e8a5fdaebf2ea0ccceca90/8c557/promise.allsettled.png 700w,\n/static/87e21874a5e8a5fdaebf2ea0ccceca90/e996b/promise.allsettled.png 1050w,\n/static/87e21874a5e8a5fdaebf2ea0ccceca90/2cefc/promise.allsettled.png 1400w,\n/static/87e21874a5e8a5fdaebf2ea0ccceca90/cea38/promise.allsettled.png 1644w\" sizes=\"(max-width: 700px) 100vw, 700px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n  </a>\n    </span><br /></p>\n<p><strong>Promise.allSettled()</strong> returns a promise when all inputs are <code class=\"language-text\">settled</code> that is either <code class=\"language-text\">fulfilled</code> or <code class=\"language-text\">rejected</code>.</p>\n<h3 id=\"-points-to-remember\" style=\"position:relative;\">üëâüèª Points to remember:<a href=\"#-points-to-remember\" aria-label=\" points to remember permalink\" class=\"blog-post-heading-link after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<ul>\n<li>Returns a promise that contains an <strong>array of results</strong>.</li>\n<li>Each <strong>result object</strong> will have <strong>two properties</strong> (<strong>status</strong> &#x26; <strong>reason/value</strong>).</li>\n<li><strong>status</strong> will be either <strong>fulfilled</strong> or <strong>rejected</strong>.</li>\n<li><strong>value</strong> if <strong>fulfilled</strong> or a <strong>reason</strong> if <strong>rejected</strong>.</li>\n</ul>\n<h4>Difference between <code class=\"language-text\">Promise.all</code> &#x26; <code class=\"language-text\">Promise.allSettled</code></h4>\n<ul>\n<li><code class=\"language-text\">Promise.all</code> will reject as soon as one of the items in the input is rejected.</li>\n<li><code class=\"language-text\">Promise.allSettled</code> will never reject and will wait until all inputs are settled.</li>\n</ul>\n<p><strong>Use cases</strong>:</p>\n<ul>\n<li>Make several APIs and wait until all of them are settled ü§î.</li>\n</ul>\n<p>I am not so sure of many use-cases. But, we want to know how it works right?. In the below example, first, we will see how it works and then will implement it.</p>\n<h4>Example:</h4>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> APICall1 <span class=\"token operator\">=</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://reqres.in/api/users?page=1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> APICall2 <span class=\"token operator\">=</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://reqres.in/api/users?page=2'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nPromise<span class=\"token punctuation\">.</span><span class=\"token function\">allSettled</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>APICall1<span class=\"token punctuation\">,</span> APICall2<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">results</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  results<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Result is below</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Log:</span>\n<span class=\"token comment\">// {status: \"fulfilled\", value: Response}</span>\n<span class=\"token comment\">// {status: \"fulfilled\", value: Response}</span></code></pre></div>\n<p>Below is a simplified version of <strong>TC39 specs</strong> to understand its implementation details.</p>\n<p><a href=\"https://tc39.es/proposal-promise-allSettled/#sec-performpromiseallsettled\" target=\"_blank\" rel=\"nofollow\">Promise.allSettled()</a> specification says</p>\n<ol>\n<li>Accepts <code class=\"language-text\">iterable</code> object as an argument.</li>\n<li>If <code class=\"language-text\">not iterable</code>, <code class=\"language-text\">throw</code> an <code class=\"language-text\">exception</code> with an error message.</li>\n<li>Iterate the argument if it is <code class=\"language-text\">iterable</code>.</li>\n<li>Keep the <code class=\"language-text\">results</code> in an array.</li>\n<li>Wait for all promises to either get <code class=\"language-text\">resolved</code>/<code class=\"language-text\">rejected</code>.</li>\n<li>Return the <code class=\"language-text\">results</code>.</li>\n</ol>\n<p>First, we will write a function to find out if the passed value is <code class=\"language-text\">iterable</code> or not.</p>\n<p>We can use [Symbol.iterator] to find it out. Read more about <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Iteration_protocols\" target=\"_blank\" rel=\"nofollow\">the iterable</a> here.</p>\n<h4>Code:</h4>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">isIterable</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">value</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// If no argument is passed or === null</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>arguments<span class=\"token punctuation\">.</span>length <span class=\"token operator\">===</span> <span class=\"token number\">0</span> <span class=\"token operator\">||</span> value <span class=\"token operator\">===</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">typeof</span> value<span class=\"token punctuation\">[</span>Symbol<span class=\"token punctuation\">.</span>iterator<span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token string\">'function'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">isIterable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\n<span class=\"token function\">isIterable</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\n<span class=\"token function\">isIterable</span><span class=\"token punctuation\">(</span>nul<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\n\n<span class=\"token function\">isIterable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n<span class=\"token function\">isIterable</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n\n<span class=\"token comment\">// String, Array, TypedArray, Map &amp; Set are all built-in iterables</span></code></pre></div>\n<p>Next step is to wrap our iteration (forEach) with <code class=\"language-text\">new Promise()</code> object. So that when all our inputs are settled, we can return the results with <strong>status</strong> and <strong>value/reasons</strong>.</p>\n<p>Implementation is quite similar to <a href=\"https://www.how-it-works.dev/posts/promise.all\" target=\"_blank\" rel=\"nofollow\">Promise.all()</a> with a few changes.</p>\n<h4>Code:</h4>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Our custom all settled function</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">isAllPromiseSettled</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">promises</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// To store our results</span>\n  <span class=\"token keyword\">var</span> results <span class=\"token operator\">=</span> <span class=\"token function\">Array</span><span class=\"token punctuation\">(</span>promises<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// To keep track of how many promises resolved</span>\n  <span class=\"token keyword\">var</span> counter <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// If not iterable throw an error</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">isIterable</span><span class=\"token punctuation\">(</span>promises<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">typeof</span> promises<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> is not iterable</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// Wrapping our iteration with Promise object</span>\n  <span class=\"token comment\">// So that we can resolve and return the results on done.</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Iterate the inputs</span>\n    promises<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">promise<span class=\"token punctuation\">,</span> index</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// Wait for each promise to resolve</span>\n      <span class=\"token keyword\">return</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>promise<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          counter<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Increment counter</span>\n\n          <span class=\"token comment\">// Store status and result in same order</span>\n          results<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> status<span class=\"token operator\">:</span> <span class=\"token string\">'fulfilled'</span><span class=\"token punctuation\">,</span> value<span class=\"token operator\">:</span> result <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n          <span class=\"token comment\">// If all inputs are settled, return the results</span>\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>counter <span class=\"token operator\">===</span> promises<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>results<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          counter<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Increment counter</span>\n\n          <span class=\"token comment\">// Store status and reason for rejection in same order</span>\n          results<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> status<span class=\"token operator\">:</span> <span class=\"token string\">'rejected'</span><span class=\"token punctuation\">,</span> reason<span class=\"token operator\">:</span> err <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n          <span class=\"token comment\">// If all inputs are settled, return the results</span>\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>counter <span class=\"token operator\">===</span> promises<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>results<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"demo\" style=\"position:relative;\">Demo:<a href=\"#demo\" aria-label=\"demo permalink\" class=\"blog-post-heading-link after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<iframe\n src=\"https://codesandbox.io/embed/funny-poitras-n174r?autoresize=1&fontsize=14&hidenavigation=1&module=%2Findex.js&theme=dark\"\n style=\"width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;\"\n title=\"Promise.allSettled\"\n allow=\"geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media; usb\"\n sandbox=\"allow-modals allow-forms allow-popups allow-scripts allow-same-origin\"\n ></iframe>\n<h3 id=\"conclusion\" style=\"position:relative;\">Conclusion<a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"blog-post-heading-link after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Yep, we did it. We learned what is <code class=\"language-text\">Promise.allSettled()</code> and implemented it. If you want to use it today, the browser support is pretty much available in all modern browsers.</p>\n<p>The browser implementation might be different than ours. Nevertheless, you get the idea, right?</p>\n<p>Thanks for reading till the end üò¨. My next post is about <code class=\"language-text\">Event Emitters</code> (Pub/Sub). If you are not subscribed, subscribe below. See you next Tuesday ;)</p>\n<hr />\n<h4>References</h4>\n<ul>\n<li><a href=\"https://tc39.es/proposal-promise-allSettled/#sec-promise.allsettled\" target=\"_blank\" rel=\"nofollow\">TC39 specs</a> for promise.allSettled.</li>\n<li><a href=\"https://github.com/domenic/promises-unwrapping/blob/master/docs/states-and-fates.md\" target=\"_blank\" rel=\"nofollow\">States and Fates</a> of promises</li>\n</ul>","frontmatter":{"date":"Mar 17, 2020","updated":null,"slug":"/blog/2020/promise.allSettled","title":"Promise.allSettled","relative":null},"fields":{"readingTime":{"text":"4 min read"}}}},"pageContext":{"slug":"/blog/2020/promise.allSettled"}},"staticQueryHashes":[]}